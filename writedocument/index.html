<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="madpanda">

    <meta name="HandheldFriendly" content="true" />
    <meta name="format-detection" content="telephone=no" />

    <title>컨셉 기획서 작성</title>

    <link rel="stylesheet" href="../files/bootstrap-4/css/bootstrap.min.css">
    <script src="../files/jquery-2.1.4.min.js"></script>
    <script src="../files/bootstrap-4/js/bootstrap.min.js"></script>
    <script src="../files/html2canvas.min.js"></script>
    <!--script src="https://unpkg.com/jspdf@latest/dist/jspdf.min.js"></script-->
    <script src="../files/jsPDF/dist/jspdf.min.js"></script>

    <!--[if lt IE 9]>
    <script src="../files/ie8-responsive-file-warning.js"></script>
    <script src="../files/html5shiv.min.js"></script>
    <script src="../files/respond.min.js"></script>
    <![endif]-->


    <script>
        $(document).ready(function()
        {
            $('#pdf_viewer').hide();
            var d = new Date();
            $('#wr_date').val(d.getFullYear()+'년 '+(d.getMonth()+1)+'월 '+d.getDate()+'일');
        });

        function save_pdf()
        {
            var title = $('#wr_title').val();
            var name = $('#wr_name').val();
            var date = $('#wr_date').val();
            var document = $('#wr_document').val().replace(/(?:\r\n|\r|\n)/g, '<br />');

            if(!title) {alert('기획서 제목을 작성해주세요.'); return;}
            if(!name) {alert('기획서를 작성한 작성자 성함을 작성해주세요.'); return;}
            if(!document) {alert('기획서 내용을 작성해주세요.'); return;}

            $('#pr_title').html(title);
            $('#pr_name').html(name);
            $('#pr_date').html(date);
            $('#pr_document').html(document);
            $('#pdf_viewer').show();

            html2canvas($('#pdf_viewer'), {
                onrendered: function(canvas) {

                    // 캔버스를 이미지로 변환
                    var imgData = canvas.toDataURL('image/png');

                    var imgWidth = 210; // 이미지 가로 길이(mm) A4 기준
                    var pageHeight = imgWidth * 1.414;  // 출력 페이지 세로 길이 계산 A4 기준
                    var imgHeight = canvas.height * imgWidth / canvas.width;
                    var heightLeft = imgHeight;

                    var position = 0;

                    var doc = new jsPDF('p', 'mm');
                    // 첫 페이지 출력
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    // 한 페이지 이상일 경우 루프 돌면서 출력
                    while (heightLeft >= 20) {
                        position = heightLeft - imgHeight;
                        doc.addPage();
                        doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    // 파일 저장
                    doc.save($('#wr_title').val()+'-'+$('#wr_name').val()+'.pdf');
                }
            });

            $('#pdf_viewer').hide();
        }


    </script>
</head>

<body>
    <div class="container" style="padding: 20px 0 20px 0; width: 600px">
        <h2>컨셉 기획서 작성하기</h2>
        <p>&nbsp;</p>
        <!--form id="frm" method="post" action="http://wbeachpension.cafe24.com/tcpdf/document-write.php"-->
        <form>
            <div class="form-group">
                <label for="wr_title">기획서 제목</label>
                <input type="text" class="form-control" id="wr_title" name="wr_title" placeholder="">
            </div>
            <div class="form-group">
                <label for="wr_name">작성자 이름</label>
                <input type="text" class="form-control" id="wr_name" name="wr_name" placeholder="">
            </div>
            <div class="form-group">
                <label for="wr_date">작성자 일자</label>
                <input type="text" readonly class="form-control" id="wr_date" name="wr_date" value="">
            </div>
            <div class="form-group">
                <label for="wr_document">기획서 작성</label>
                <textarea class="form-control" id="wr_document" name="wr_document" rows="10"></textarea>
            </div>
        </form>
        <p>
            <button class="btn btn-block btn-success" onclick="save_pdf()">저장하기</button>
        </p>
    </div>

    <div class="container" id="pdf_viewer" style="padding: 20px;">
        <h1 id="pr_title" style="text-align: center"></h1>
        <div style="float: right; font-size: 1.2em;">
            <p>작성자 : <span id="pr_name"></span></p>
            <p>작성일 : <span id="pr_date"></span></p>
        </div>
        <div id="pr_document" style="margin-top: 120px; font-size: 1.2em;"></div>
    </div>

</body>

</html>